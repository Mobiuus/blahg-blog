---
// src/pages/bookshelf.astro
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { getAllBooks } from "../lib/books";
import { FaChevronLeft, FaChevronRight } from "react-icons/fa";

const books = getAllBooks();
---

<html lang="en">
  <head>
    <BaseHead title="Bookshelf | Your Site" description="My bookshelf" />
    <style>
      .bookshelf-title {
        text-align: center;
        font-size: 1.2em;
        margin-bottom: 20px;
        color: #888;
      }
      .bookshelf-container {
        position: relative;
        width: 100%;
        max-width: 80ch;
        margin: 0 auto;
        overflow: hidden;
        padding: 0 60px;
      }
      .bookshelf {
        display: flex;
        padding: 40px 0;
        transition: transform 0.3s ease;
      }
      .book-container {
        perspective: 1000px;
        width: 41.5px;
        height: 220px;
        flex-shrink: 0;
        transform-style: preserve-3d;
        transition: all 0.5s ease;
        margin-right: 12px;
      }
      .book {
        width: 100%;
        height: 100%;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.5s;
        cursor: pointer;
      }
      .book-spine {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        writing-mode: vertical-rl;
        text-orientation: mixed;
        font-size: 12px;
        backface-visibility: hidden;
        transition: transform 0.5s;
        transform-origin: left;
        background-color: inherit;
        filter: brightness(0.8) contrast(2);
      }
      .book-spine::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        opacity: 0.4;
        filter: url(#paper);
        pointer-events: none;
      }
      .book-cover {
        position: absolute;
        width: 166px;
        height: 100%;
        left: 41.5px;
        backface-visibility: hidden;
        transform: rotateY(90deg);
        transition: transform 0.5s;
        transform-origin: left;
        background-size: cover;
        background-position: left center;
        filter: brightness(0.8) contrast(2);
      }
      .book-cover::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        opacity: 0.4;
        filter: url(#paper);
        pointer-events: none;
      }
      .book-cover::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(to right, rgba(255, 255, 255, 0) 2px, rgba(255, 255, 255, 0.5) 3px, rgba(255, 255, 255, 0.25) 4px, rgba(255, 255, 255, 0.25) 6px, transparent 7px, transparent 9px, rgba(255, 255, 255, 0.25) 9px, transparent 12px);
        pointer-events: none;
      }
      .book.open {
        transform: translateX(-41.5px);
      }
      .book.open .book-spine {
        transform: rotateY(-90deg);
      }
      .book.open .book-cover {
        transform: rotateY(0deg);
      }
      .book-container.open {
        width: 207.5px;
        margin-right: 12px;
        margin-left: -29px;
      }
      .scroll-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.5);
        border: none;
        padding: 20px 10px;
        font-size: 20px;
        cursor: pointer;
        z-index: 10;
        transition: all 0.3s ease;
      }
      .scroll-arrow:hover {
        background: rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.8);
      }
      .scroll-left { left: 0; }
      .scroll-right { right: 0; }
      .book-details {
        display: none;
        margin-top: 40px;
        padding: 20px 40px;
        border-top: 1px solid #333;
        text-align: left;
        max-width: 70ch;
        margin-left: auto;
        margin-right: auto;
      }
      .book-details h3 {
        margin: 0;
        font-size: 1.4em;
        color: #fff;
        font-weight: bold;
        text-align: left;
      }
      .book-details p {
        margin: 10px 0;
        color: #888;
        text-align: left;
      }
      .book-details .author {
        font-style: italic;
        color: #888;
        margin-top: 10px;
        text-align: left;
      }
      
      @media (max-width: 768px) {
        .bookshelf-container {
          padding: 0 30px;
        }
        .book-details {
          padding: 20px 20px;
        }
      }
    </style>
  </head>
  <body class="bookshelf-page">
    <Header title="Bookshelf" />
    <main>
      <h2 class="bookshelf-title">A virtual version of my real bookshelf!</h2>
      <svg style={{ position: "absolute", inset: 0, visibility: "hidden" }}>
        <defs>
          <filter id="paper" x="0%" y="0%" width="100%" height="100%">
            <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="8" result="noise" />
            <feDiffuseLighting in="noise" lighting-color="white" surfaceScale="1" result="diffLight">
              <feDistantLight azimuth="45" elevation="35" />
            </feDiffuseLighting>
          </filter>
        </defs>
      </svg>
      <div class="bookshelf-container">
        <div class="scroll-arrow scroll-left"><FaChevronLeft /></div>
        <div class="scroll-arrow scroll-right"><FaChevronRight /></div>
        <div class="bookshelf" id="bookshelf">
          {books.map((book) => (
            <div class="book-container">
              <div class="book" data-slug={book.slug} data-author={book.author} data-summary={book.summary}>
                <div 
                  class="book-spine"
                  style={`background-color: ${book.spineColor}; color: ${book.textColor};`}
                >
                  {book.title}
                </div>
                <div 
                  class="book-cover" 
                  style={`background-image: url(${book.coverImage});`}
                ></div>
              </div>
            </div>
          ))}
        </div>
      </div>
      <div id="book-details" class="book-details"></div>
    </main>
    <Footer />
    <script>
      // Le script JavaScript reste inchangé
      // ... (insérez ici le script JavaScript existant)
    </script>
  </body>
</html>