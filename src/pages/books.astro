---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import ChakraProviderWrapper from "../components/ChakraWrapper.astro";
import Bookshelf from "../components/Bookshelf";
import { getAllBooks } from "../lib/books";
import { Stack, Divider, Flex, Image, VStack, Heading, Text } from "@chakra-ui/react";

const books = getAllBooks();
const sortedBooks = books.sort((a, b) => b.rating - a.rating);
---

<html lang="en-us">
  <head>
    <BaseHead title="Books | Your Site" description="My bookshelf" />
  </head>
  <body>
    <ChakraProviderWrapper>
      <Header title="Books" />
      <main>
        <Bookshelf books={books} client:load />
        <Stack spacing={5}>
          {sortedBooks.map((book, index) => (
            <Stack key={book.title} scroll-margin-top={20}>
              <Stack>
                {index > 0 && <Divider mb={3} width="100%" />}
                <Flex direction="row" align="flex-start" gap={6}>
                  <Image
                    border="1px solid"
                    borderColor="gray.200"
                    src={book.coverImage}
                    alt={book.title}
                    height="160px"
                  />
                  <VStack align="flex-start" flexGrow={1}>
                    <a href={`/books/${book.slug}`}>
                      <Heading size="md">{book.title}</Heading>
                    </a>
                    <Text color="#999" size="md">
                      {book.author}
                    </Text>
                    <Text color="#666">
                      Read: {book.date} â€¢ Rating: {book.rating}/10
                    </Text>
                    <div set:html={book.summary} />
                  </VStack>
                </Flex>
              </Stack>
            </Stack>
          ))}
        </Stack>
      </main>
      <Footer />
    </ChakraProviderWrapper>
  </body>
</html>